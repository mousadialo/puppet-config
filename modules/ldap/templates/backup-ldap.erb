#!/bin/bash

# directory to backup to
BACKDIR=<%= @ldap_backup_directory %>

# LDAP directory manager password
DMPWD=<%= @root_dn_pwd %>

# date format that is appended to filename
DATE=$(date +'%Y-%m-%d')

# check if the backup directory exists
if [ ! -e $BACKDIR ]
then
 echo Backup directory does not exist!
 exit 1
fi

ldapsearch -LLL -x -D "cn=Directory Manager" -w "$DMPWD" | gzip -c | aws s3 cp - s3://hcs-backups/ldap/$DATE.ldif.gz
